commit -m "6/27_8:00AM"
База данных PostgreSQL					93.8	zabbix
Конфиги и веб-интерфейс Zabbix			93.7	/etc/zabbix, /usr/share/zabbix
Хранилище	/mnt/nfs/zabbix_backup	Монтировано с 93.5

1.# Check pg_dump possibility
sudo -u zabbix pg_dump zabbix | gzip > /tmp/zabbix_db.sql.gz
ls -lh /tmp/zabbix_db*
#Check Mounting and move file
mount | grep zabbix_backup
Variant A: Create dump, copy and remove from temp
cp /tmp/zabbi_db.sql.gz /mnt/nfs/zabbix_client_db/zabbix_db_$(date +%F_%H-%M).sql.gz
rm -rm /tmp/zabbi_db
Variant B: dump directly to NFS (Пока что лучший вариант)
sudo -u zabbix pg_dump zabbix | gzip | sudo -u zabbixclidb tee /mnt/nfs/zabbix_client_db/zabbix_db_$(date +%F_%H-%M).sql.gz > /dev/null

Вручную работает всё ок. Теперь автаматизируем через bash script и cron.
1.# Preparing scrip
nano /opt/zabbix_db_bk.sh
chmod +x /opt/zabbix_db_bk
#!/bin/bash --> scrip in file "dump-gzip-mv_zabbix_backup_delete_old"
2. # Setting Cron
crontab -e
55 8 * * * /opt/zabbix_db_bk.sh #Running every 5 mins ... Yes it works




sudo -u zabbixcli du -sh /mnt/nfs/zabbix_client/



сделать бэкап конфигов и веб-файлов Zabbix на сервере 93.7.
+/etc/zabbix
+/usr/share/zabbix
+/usr/lib/zabbix
+/var/log/zabbix/
вот что бэкапим
Делаем по шагово, не торопимся и провирям каждый шаг.
Инфа: /mnt/nfs/zabbix_cliet - сюда все бэкапы, он отпрвалят на NFS сервер
zabbixcli единственный юзер который может делать опервции в этой папке. 


ls -ld /mnt/nfs/zabbix_client

tar -czf - /etc/zabbix | sudo -u zabbixcli tee /mnt/nfs/zabbix_client/etc_zabbix_backup_$(date +%F_%H-%M).tar.gz > /dev/null

sudo -u zabbixcli ls -lh /mnt/nfs/zabbix_client | grep etc/zabbix_backup

tar -czf - /usr/share/zabbix | sudo -u zabbixcli tee /mnt/nfs/zabbix_client/share_zabbix_backup_$(date +%F_%H-%M).tar.gz > /dev/null
sudo -u zabbixcli ls -lh /mnt/nfs/zabbix_client/ | grep share_zabbix_backup
tar -czf - /usr/lib/zabbix | sudo -u zabbixcli tee /mnt/nfs/zabbix_client/lib_zabbix_backup_$(date +%F_%H-%M).tar.gz > /dev/null
sudo -u zabbixcli ls -lh /mnt/nfs/zabbix_client/ | grep lib_zabbix_backup



