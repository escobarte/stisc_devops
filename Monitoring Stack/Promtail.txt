ğŸ› ï¸ ğŸ› ï¸ ğŸ› ï¸ĞŸÑ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ğŸ› ï¸ ğŸ› ï¸ ğŸ› ï¸
ğŸ“Œ ğŸ“Œ ğŸ“Œ Promtail ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑÑ Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€, Ğ³Ğ´Ğµ Ğ»ĞµĞ¶Ğ¸Ñ‚ access.log.ğŸ“Œ ğŸ“Œ ğŸ“Œ 
Ğ£Ğ¶Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Loki Ğ² docker-compose (Ñ‚Ñ‹ ĞµĞ³Ğ¾ ÑƒĞ¶Ğµ Ğ¿Ğ¾Ğ´Ğ½ÑĞ»)
Ğ£Ğ¶Ğµ ĞµÑÑ‚ÑŒ Grafana Ğ¸ Prometheus
NGINX access.log Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¸ÑˆĞµÑ‚ÑÑ (ĞµÑÑ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ½Ğ° prx-ÑĞµÑ€Ğ²ĞµÑ€Ğ°Ñ…)
Steps:
1. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Promtail Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€, Ğ³Ğ´Ğµ Ğ½ÑƒĞ¶Ğ½Ñ‹ Ğ»Ğ¾Ğ³Ğ¸
Promtail Ğ±ÑƒĞ´ĞµÑ‚ "Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ" Ñ‚Ğ²Ğ¾Ğ¹ /var/log/nginx/access.log Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ ÑÑ‚Ñ€Ğ¾Ñ‡ĞºĞ¸ Ğ² Loki
2. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ Promtail
Ğ£ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿ÑƒÑ‚ÑŒ Ğº access.log
Ğ£ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ°Ğ´Ñ€ĞµÑ Loki (ĞºÑƒĞ´Ğ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ)
ĞŸÑ€Ğ¾Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ label'Ñ‹ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, server, role, hostname â€” Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ² Grafana)
3. ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Loki (Ğ¿Ğ¾Ñ€Ñ‚ 3100) Ğ´Ğ»Ñ prx-ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²
ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ Promtail Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ² Loki
Ğ§ĞµÑ€ĞµĞ· Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Grafana â†’ Data Sources â†’ Explore (Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Loki)
5. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ² Grafana
Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°/Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ access.log (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ¸ÑĞºĞ°Ñ‚ÑŒ 500 Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸, Ğ¸Ğ»Ğ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ URI/Ğ¼ĞµÑ‚Ğ¾Ğ´Ñƒ/response code)

ğŸ› ï¸Step-1: Find Loki version 
docker ps
	(a712a476e406   grafana/loki:latest      "/usr/bin/loki -confâ€¦"   2 days ago   Up 2 days       0.0.0.0:3100->3100/tcp, [::]:3100->3100/tcp   loki)
docker exec a712a476e406 /usr/bin/loki --version
	loki, version 3.5.1
	
##### Temp code version
 1023  14/07/25 10:37:34 cd /tmp/
 1024  14/07/25 10:37:34 wget https://github.com/grafana/loki/releases/download/v3.5.2/promtail-linux-amd64.zip
 1025  14/07/25 10:38:38 ls
 1026  14/07/25 10:38:46 unzip promtail-linux-amd64.zip
 1027  14/07/25 10:38:50 apt install unzip
 1028  14/07/25 10:38:55 unzip promtail-linux-amd64.zip
 1029  14/07/25 10:38:57 ls
 1030  14/07/25 10:39:14 chmod a+X promtail-linux-amd64
 1031  14/07/25 10:39:31 cp promtail-linux-amd64 /usr/local/bin/promtail
 1032  14/07/25 10:39:37 promtail --version
 1034  14/07/25 11:00:04 nano /etc/promtail.yaml
 server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /var/log/promtail-positions.yaml

clients:
  - url: http://10.100.93.5:3100/loki/api/v1/push

scrape_configs:
  - job_name: nginx-logs
    static_configs:
      - targets:
          - localhost
        labels:
          job: nginx-access
          host: prx01
          __path__: /var/log/nginx/access.log
 1035  14/07/25 11:00:46 promtail -config.file /etc/promtail.yaml
 1036  14/07/25 11:01:10 nano /etc/systemd/system/promtail.service
[Unit]
Description=Promtail service
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/promtail -config.file /etc/promtail.yaml
Restart=on-failure

[Install]
WantedBy=multi-user.target
 1037  14/07/25 11:01:28 systemctl daemon-reload
 1038  14/07/25 11:01:36 systemctl enable --now promtail
 1039  14/07/25 11:01:46 systemctl status promtail
 1040  14/07/25 11:01:57 journalctl -u promtail -n 50 --no-pager
 
 
ğŸ’¡ğŸ’¡ğŸ’¡ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Data Source ğŸ’¡ğŸ’¡ğŸ’¡
Web: Grafana/Datasource
+ Add New Datasource
URL: http://10.100.93.5:3100
Save+Test

ğŸ› ï¸ğŸ› ï¸ğŸ› ï¸ Test ğŸ› ï¸ğŸ› ï¸ğŸ› ï¸
Explorer: Loki
Querry: Job : nginx-access
