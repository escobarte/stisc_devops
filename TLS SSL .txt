SSL/TLS

OpenSSL ‚Äî —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π, –≤–∫–ª—é—á–∞—è:
	—Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
	–≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π
	—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ CSR (–∑–∞–ø—Ä–æ—Å–∞–º–∏ –Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã)
	–Ω–∞—Å—Ç—Ä–æ–π–∫—É —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è TLS

–ë—Ä–∞—É–∑–µ—Ä –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç. –°–∞–π—Ç –æ—Ç—Å—ã–ª–∞–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç. –ë—Ä–∞—É–∑–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
	–ü–æ–¥–ø–∏—Å—å –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞
–°	–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –∏–º—è –¥–æ–º–µ–Ω–∞
–ï—Å–ª–∏ –≤—Å—ë –æ–∫ ‚Äî —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —à–∏—Ñ—Ä—É–µ—Ç—Å—è.

–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç?
–û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç:
	–ò–º—è –¥–æ–º–µ–Ω–∞
	–î–∞–Ω–Ω—ã–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–µ—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ "–¥–µ—à—ë–≤—ã–π")
	–î–∞—Ç—É –≤—ã–¥–∞—á–∏ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è
	–ü–æ–¥–ø–∏—Å—å —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞ (CA ‚Äî Certificate Authority)

| –£—Ä–æ–≤–µ–Ω—å | –ü—Ä–∏–º–µ—Ä                  | –ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è                           |
| ------- | ----------------------- | ---------------------------------------- |
| 1       | `com`                   | **–î–æ–º–µ–Ω –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è (TLD)**          |
| 2       | `example.com`           | **–û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω (second-level domain)** |
| 3       | `shop.example.com`      | **–ü–æ–¥–¥–æ–º–µ–Ω —Ç—Ä–µ—Ç—å–µ–≥–æ —É—Ä–æ–≤–Ω—è**             |
| 4       | `mail.shop.example.com` | **–ü–æ–¥–¥–æ–º–µ–Ω —á–µ—Ç–≤—ë—Ä—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è**           |

| –¢–∏–ø                    | –ß—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç                                                  |
| ---------------------- | ------------------------------------------------------------- |
| **Single-domain**      | –¢–æ–ª—å–∫–æ 1 –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `example.com`)                      |
| **Wildcard**           | –û–¥–∏–Ω –¥–æ–º–µ–Ω –∏ –≤—Å–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è (`*.example.com`)   |
| **Multi-domain (SAN)** | –ù–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `site1.com`, `site2.org`) |

| –¢–∏–ø    | –ü—Ä–æ–≤–µ—Ä–∫–∞                               | –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è           |
| ------ | -------------------------------------- | ---------------------- |
| **DV** | Domain Validation ‚Äî —Ç–æ–ª—å–∫–æ –¥–æ–º–µ–Ω       | –ü—Ä–æ—Å—Ç—ã–µ —Å–∞–π—Ç—ã, –±–ª–æ–≥–∏   |
| **OV** | Organization Validation ‚Äî –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è  | –ë–∏–∑–Ω–µ—Å-—Å–∞–π—Ç—ã           |
| **EV** | Extended Validation ‚Äî —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | –ë–∞–Ω–∫–∏, –∫—Ä—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã |

–ü—Ä–∏–º–µ—Ä—ã, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:
| –°—Ü–µ–Ω–∞—Ä–∏–π                           | –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç                           |
| ---------------------------------- | ------------------------------------ |
| –û–¥–∏–Ω —Å–∞–π—Ç (–±–ª–æ–≥, –≤–∏–∑–∏—Ç–∫–∞)          | Single-domain DV (–∏–ª–∏ Let's Encrypt) |
| –°–∞–π—Ç —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤       | Wildcard                             |
| –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–∞–π—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ | Multi-domain (SAN)                   |
| –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π/–≥–æ—Å/–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –ø–æ—Ä—Ç–∞–ª  | EV –∏–ª–∏ OV                            |


----------------------
–û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º **–ø–æ—à–∞–≥–æ–≤—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É TLS 1.3 –Ω–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–µ**, –Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞ **Ubuntu 22.04 —Å Nginx** (–º–æ–∂–µ–º –ø–æ—Ç–æ–º –∏ Apache —Ä–∞–∑–æ–±—Ä–∞—Ç—å).
---
## üñ•Ô∏è –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º):
* –°–µ—Ä–≤–µ—Ä: Ubuntu 22.04
* –í–µ–±-—Å–µ—Ä–≤–µ—Ä: **Nginx**
* –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç: –•–æ—Ç–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Let's Encrypt** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
* –¶–µ–ª—å: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **TLS 1.3**
---
## üîß –®–∞–≥ 1. –£—Å—Ç–∞–Ω–æ–≤–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```bash
sudo apt update
sudo apt install nginx openssl curl software-properties-common
```
–£–±–µ–¥–∏—Å—å, —á—Ç–æ —É —Ç–µ–±—è Nginx —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π TLS 1.3:
```bash
nginx -V 2>&1 | grep -o 'OpenSSL[^)]*'
```
‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `OpenSSL 1.1.1` –∏–ª–∏ `OpenSSL 3.x`
---
## üîí –®–∞–≥ 2. –ü–æ–ª—É—á–∏ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç Let's Encrypt (—á–µ—Ä–µ–∑ certbot)
### –£—Å—Ç–∞–Ω–æ–≤–∏ certbot:
```bash
sudo apt install certbot python3-certbot-nginx
```
### –ü–æ–ª—É—á–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:
```bash
sudo certbot --nginx -d example.com -d www.example.com
```
–ó–∞–º–µ–Ω—è–µ—à—å `example.com` –Ω–∞ —Å–≤–æ–π –¥–æ–º–µ–Ω. Certbot —Å–∞–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç nginx.
---
## ‚öôÔ∏è –®–∞–≥ 3. –í–∫–ª—é—á–∏ TLS 1.3 –≤ –∫–æ–Ω—Ñ–∏–≥–µ NGINX
–û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª:
```bash
sudo nano /etc/nginx/sites-available/default
```
–ò–ª–∏ —Ñ–∞–π–ª —Ç–≤–æ–µ–≥–æ —Å–∞–π—Ç–∞.
### –î–æ–±–∞–≤—å/–ø—Ä–æ–≤–µ—Ä—å –±–ª–æ–∫ SSL:
```nginx
ssl_protocols TLSv1.2 TLSv1.3;
ssl_prefer_server_ciphers off;
ssl_ciphers 'TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256';
```
### –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —É–∫–∞–∑–∞–Ω—ã:
```nginx
ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
```
(—ç—Ç–∏ –ø—É—Ç–∏ certbot –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–∞–º)
---
## ‚úÖ –®–∞–≥ 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
–ü—Ä–æ–≤–µ—Ä—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:
```bash
sudo nginx -t
```
–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ nginx:
```bash
sudo systemctl reload nginx
```
---
## üß™ –®–∞–≥ 5. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ TLS 1.3 –≤–∫–ª—é—á—ë–Ω

### üîπ –û–Ω–ª–∞–π–Ω:
–ó–∞–π–¥–∏ —Å—é–¥–∞:
üîó [https://www.ssllabs.com/ssltest/](https://www.ssllabs.com/ssltest/)
–í–≤–µ–¥–∏ —Å–≤–æ–π –¥–æ–º–µ–Ω ‚Äî –∏ —Å–º–æ—Ç—Ä–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "Protocols" ‚Üí TLS 1.3 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ‚úÖ
### üîπ –ò–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:
```bash
openssl s_client -connect example.com:443 -tls1_3
```
–ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ ‚Äî –∑–Ω–∞—á–∏—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç.
---
## üéâ –í—Å—ë –≥–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è:

* –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç Let's Encrypt (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TLS 1.3
* Nginx –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
---

